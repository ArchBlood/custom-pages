/**
 * plugin.js
 *
 * @link https://www.humhub.org/
 * @copyright Copyright (c) 2022 HumHub GmbH & Co. KG
 * @license https://www.humhub.com/licences
 * @author Lucas Bartholemy <lucas@bartholemy.com>
 */
tinymce.PluginManager.add("wrapper",(function(t,e){const s=t.getParam("wrapper"),n={items:[{tag:"div",class:"panel panel-default",style:"background:#ededed; padding:5px; margin:-1rem"},{tag:"div",class:"panel-body",style:"background:#fff; border-radius:4px; box-shadow:0 0 3px #dadada; padding:10px"}],wrap:function(t){return this.startHtml()+t+this.endHtml()},unwrap:function(t){const e=new RegExp("^"+this.regexp("(.+?)")+"$","is");return t.replace(e,"$1")}};t.ui.registry.addToggleButton("wrapper",{icon:"unselected",text:s.text,tooltip:s.tooltip,onAction:e=>{const s=t.getContent();n.isActive()?(t.setContent(n.unwrap(s)),e.setActive(!1)):(t.setContent(n.wrap(s)),e.setActive(!0))},onSetup:e=>{e.setActive(n.isActive()),t.on("NodeChange",(()=>{e.setActive(n.isActive()),n.cleanup()}))}}),n.isActive=function(){const e=t.dom.getRoot().childNodes;return 1===e.length&&t.dom.is(e[0],this.selector(0))&&1===e[0].childNodes.length&&t.dom.is(e[0].childNodes[0],this.selector(1))},n.startHtml=function(t){void 0===t&&(t="");let e="";for(let s=0;s<this.items.length;s++)e+="<"+this.items[s].tag,this.items[s].class&&(e+=' class="'+this.items[s].class+'"'),e+=">",s<this.items.length-1&&(e+=t);return e},n.endHtml=function(t){void 0===t&&(t="");let e="";for(let s=this.items.length-1;s>=0;s--)e+="</"+this.items[s].tag+">",s>0&&(e+=t);return e},n.selector=function(t){const e=this.items[t];let s=e.tag;return e.class&&(s+="."+e.class.replace(" ",".")),s},n.regexp=function(t){return this.startHtml(".*?")+t+this.endHtml(".*?")},n.cleanup=function(){const e=t.getContent();let s="<p>&nbsp;<\\/p>";if(!e.match(new RegExp(s,"i")))return;s="([\\r\\n]*"+s+"[\\r\\n]*)?";const n=new RegExp("^"+s+"("+this.regexp(".+?")+")"+s+"$","is"),i=e.replace(n,"$2");i!==e&&t.setContent(i)},n.initStyles=function(){let e="",s="";for(let t=0;t<this.items.length;t++)e+=s+this.selector(t)+" {"+this.items[t].style+"}",s=this.selector(t)+" ";t.contentStyles.push(e)},n.initStyles()}));
